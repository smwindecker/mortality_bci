Mortality models - currently in draft form
========================================================

Below outlines the skeleton structure of potential mortality
models that can be run through JAGS.
These models incorporate changes in hazard rate with time.

Currently only including models based on Daniel's 2011 paper.
Will add other models later.

Also will convert these models to run in stan and 
vectorise where possible.
Models are likely to converge alot faster then using
the gibb sampler in JAGS.

Data will need to be supplied in long format.
i.e. individual measurements in all years occur as rows.
This allows makes it easier to sample individuals that
drop out during 1990 - 2010 while also accounting for new 
recruits. Data will contain only single stemmed plants that
are alive for at least 2 censuses and contain required trait data.

```{r Daniel's model - no random effects for species}  
model {
  for(it in 1:n.obs) {
    # Loop over observations (seedling at site at time).
    # Seedling status, y, is bernoulii with prob=p.
    # Complementary log-log link.
    # Intercept (expected mortality rate).
    y[it] ~ dbern(p[it])
    cloglog(p[it]) <-
      IndMort * exp( - beta[1] * WD[it])  + GRMort * exp(- beta[2]* basal.rgr[it])) +
      logT[it] - # log of time since last observation
      (p[PREV1[it]] +   # Probability of death at last timestep.
         p[PREV2[it]] + # Probability of death at last 2 timesteps.
         p[PREV3[it]] + # Probability of death at last 3 timesteps.
         p[PREV4[it]] + # Probability of death at last 4 timesteps.
         p[PREV5[it]])  # Probability of death at last 5 timesteps.
  }

#Priors

IndMort[j] ~ dnorm(0, 0.0001) # C0 in Daniels model (growth independent)
GRMort[j] ~ dnorm(0, 0.0001) # C2 in Daniels model (growth dependent)

beta[1] ~ dnorm(0, .0001) # Effect of woody density on intrinsic mortality (c1)
beta[2] ~ dnorm(0, .0001) # Effect of growth rate on intrinsic mortality (c3)

p[P0] <- 0 # P0 is a supplied object defining the n.obs + 1
```

You can also embed plots, for example:

```{r Daniel's model with species random effect}
model {
  for(it in 1:n.obs) {
    # Loop over observations (seedling at site at time).
    # Seedling status, y, is bernoulii with prob=p.
    # Complementary log-log link.
    # Intercept (expected mortality rate).
    y[it] ~ dbern(p[it])
    cloglog(p[it]) <-
      IndMort[SPP[it]] * exp( - beta[1] * WD[it])  + GRMort[SPP[it]] * exp(- beta[2]* basal.rgr[it])) +
      logT[it] - # log of time since last observation
      (p[PREV1[it]] +   # Probability of death at last timestep.
         p[PREV2[it]] + # Probability of death at last 2 timesteps.
         p[PREV3[it]] + # Probability of death at last 3 timesteps.
         p[PREV4[it]] + # Probability of death at last 4 timesteps.
         p[PREV5[it]])  # Probability of death at last 5 timesteps.
  }
    
# Species random effects on C0 and C2 of Daniels model
for(j in 1:n.spp){
IntMort[j] ~ dnorm(IntGM.SPP, IntSD.SPP^-2)
GRMort[j] ~ dnorm(GRMort.SPP, GRSD.SPP^-2)
}
# Coefficient priors on C1 and C3

beta[1] ~ dnorm(0, .0001) # Effect of woody density on intrinsic mortality (C1)
beta[2] ~ dnorm(0, .0001) # Effect of growth rate on intrinsic mortality (C3)
IndGM.SPP ~ dnorm(0, 0.0001) # Mean independent mortality rate (across species)
GRMort.SPP ~ dnorm(0, 0.0001) # Mean Growth related mortality rate across species
IntSD.SPP ~ dunif(0, 100) # Variation in SPP independent intrinic mortality rate
GRSD.SPP ~ dunif(0, 100) # Variation in SPP growth dependent intrinsic rate

p[P0] <- 0 # This gets added as value 2012 for p in Will's model.

```